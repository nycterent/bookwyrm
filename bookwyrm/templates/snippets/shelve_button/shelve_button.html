{% load bookwyrm_tags %}
{% load utilities %}
{% load cache %}

{% if request.user.is_authenticated %}
{# 6 month cache #}
{% cache 15552000 shelve_button request.user.id book.id %}

{% with book.id|uuid as uuid %}
{% active_shelf book as active_shelf %}
{% latest_read_through book request.user as readthrough %}
<div class="field has-addons mb-0 has-text-weight-normal" data-shelve-button-book="{{ book.id }}">
    {% if switch_mode and active_shelf.book != book %}
    <div class="control">
        {% include 'snippets/switch_edition_button.html' with edition=book size='is-small' %}
    </div>
    {% else %}
    <div class="control">
        {% include 'snippets/shelve_button/shelve_button_options.html' with class="shelf-option is-small" shelves=user_shelves active_shelf=active_shelf button_uuid=uuid %}
    </div>
    {% include 'snippets/shelve_button/shelve_button_dropdown.html' with class="is-small" button_uuid=uuid%}
    {% endif %}
</div>

{% join "want_to_read" uuid as modal_id %}
{% include 'snippets/reading_modals/want_to_read_modal.html' with book=active_shelf.book id=modal_id class="" %}

{% join "start_reading" uuid as modal_id %}
{% include 'snippets/reading_modals/start_reading_modal.html' with book=active_shelf.book id=modal_id class="" %}

{% join "finish_reading" uuid as modal_id %}
{% include 'snippets/reading_modals/finish_reading_modal.html' with book=active_shelf.book id=modal_id readthrough=readthrough class="" %}

{% join "progress_update" uuid as modal_id %}
{% include 'snippets/reading_modals/progress_update_modal.html' with book=active_shelf.book id=modal_id readthrough=readthrough class="" %}

{% endwith %}
{% endcache %}
{% endif %}
